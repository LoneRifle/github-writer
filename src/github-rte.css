/**
 * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */

/*
	These are application specific styles, not the CKEditor theme.
*/

/*
Here we hide some of the original GH elements that could be flashing on page load,
right before being replaced with the rte editor.
*/
body:not(.github-rte-loaded) markdown-toolbar md-mention,
body:not(.github-rte-loaded) markdown-toolbar md-ref,
body:not(.github-rte-loaded) markdown-toolbar details,
body:not(.github-rte-loaded) .preview-tab,
body:not(.github-rte-loaded) .tabnav-extra,
body:not(.github-rte-loaded) .drag-and-drop,
body:not(.github-rte-loaded) #gollum-editor-function-bar,
body:not(.github-rte-loaded) #gollum-editor-help,
body:not(.github-rte-loaded) #gollum-editor-body {
	display: none !important;
}

div.github-rte-ckeditor .ck-editor__editable {
	min-height: inherit;

	/* TODO: We're hardcoding a fixed height here.
	   It seems that GH originally calculates the height based on the viewport size, instead. */
	max-height: 350px;
}

div.github-rte-ckeditor .ck-editor__editable.ck-blurred {
	background-color: #fafbfc;
}

div.github-rte-ckeditor .ck-editor__editable.ck-focused {
	background-color: #fff;
}

/* The CKEditor placeholder. Matches the inspected rules from the GH textarea on Chrome. */
.ck.ck-editor__editable > .ck-placeholder::before {
	color: #6a737d;
	opacity: .54;
}

/* RTE mode */

/* Hide the "Preview" tab. */
.github-rte-mode-rte .preview-tab {
	display: none;
}

/* Hide the markdown textarea outer box. */
.github-rte-mode-rte .github-rte-panel-markdown,
.github-rte-mode-rte .github-rte-panel-preview {
	display: none !important;
}

/* Hide all markdown toolbar. */
.github-rte-mode-rte markdown-toolbar {
	display: none !important;
}

/* Remove the markdown message when in RTE. */
.github-rte-mode-rte .tabnav-extra {
	display: none;
}

/* Markdown mode */

/* Hide the rte textarea outer box. */
.github-rte-mode-markdown .github-rte-panel-rte {
	display: none !important;
}

/* Hide all rte toolbar items. */
.github-rte-mode-markdown .ck.ck-toolbar__separator,
.github-rte-mode-markdown .ck-file-dialog-button,
.github-rte-mode-markdown .ck.ck-button {
	display: none !important;
}

/* Except the Kebab and Markdown buttons. */
.github-rte-mode-markdown .ck.ck-button.github-rte-kebab-button,
.github-rte-mode-markdown .ck.ck-button.github-rte-mode-button {
	display: block !important;
}

/* Get the GH toolbar closer to the RTE one (which is always available with the the Kebab button). */
.github-rte-mode-markdown markdown-toolbar.px-2 {
	padding-right: 0 !important;
}
.github-rte-mode-markdown .ck.github-rte-toolbar {
	margin-left: -4px;
}

/* Change the text of the "Write" tab. */
.github-rte-mode-markdown .write-tab {
	font-size: 0;
	line-height: 0;
}
.github-rte-mode-markdown .write-tab::after {
	content: "Markdown";
	font-size: 14px;
	line-height: 20px;
}

/* Classes are prefixed with "div" so they have higher specificity and override default rules. */

/* The following rules are mainly overriding defaults coming from CKEditor and GitHub. */

div.github-rte-ckeditor .ck-editor__editable.ck-focused {
	border: none !important;
	box-shadow: none !important;
}

div.github-rte-ckeditor .ck-editor__editable {
	border: none !important;
	padding: 0 8px;
	resize: vertical;
	width: 100%;
	/*	min-height: 100px; */
}

div.github-rte-ckeditor {
	height: auto !important;
}

/* The following rules needed to be copied because they're applied to the textarea directly, while the editable is a div.
   Most of the CSS here are copies from teh markdown textarea CSS, sniffed with the inspector. */
div.github-rte-ckeditor {
	display: block;
	width: 100%;
	max-width: 100%;
	padding: 0 !important;
	margin: 0;
	line-height: 1.6;
}

/* Fix the bottom border of the PR review editor. */
div.github-rte-ckeditor.comment-body {
	border-bottom: 1px solid #d1d5da !important;
}

div.github-rte-ckeditor:focus-within,
div.github-rte-ckeditor.comment-body:focus-within {
	border-color: #2188ff !important;
}

/* Do not show the arrow in the Kebab button. */
.github-rte-kebab-button .ck-dropdown__arrow {
	display: none;
}

/* Here, we're fixing up a bit of mess from the GH CSS itself. The comment editing CSS is different from other editors in GH :/ */
div.comment-form-head {
	padding: 8px 0 0 !important;
	display: flex;
	align-items: center;
}
div.comment-form-head > * {
	margin-top: -8px !important;
}
div.tabnav-tabs,
nav.tabnav-tabs {
	flex: auto;
	margin: auto 8px -1px 8px !important;
	order: -1;
	white-space: nowrap;
}

/*******************************
	Wiki page specific stuff
********************************/

/* Fix the toolbar position. */
.github-rte-type-wiki .comment-form-head {
	display: flex;
}
.github-rte-type-wiki .comment-form-head > :first-child {
	flex: auto;
}

.github-rte-type-wiki.github-rte-mode-rte .comment-form-head {
	/* Sticky toolbar. */
	position: sticky !important;
	top: 0;
	z-index: 1;  /* The editable may somehow show above the toolbar, so we raise its plane. */
}

.github-rte-type-wiki .form-actions {
	position: sticky !important;
	bottom: 10px;
	z-index: 1;
}

/* Hide the markdown toolbar. */
.github-rte-type-wiki.github-rte-mode-rte #gollum-editor-function-bar {
	display: none;
}

/* Remove the editor margin, as we don't have the frame around in in wiki. */
.github-rte-type-wiki .github-rte-panel-rte {
	margin: 0 !important;
}

/* Make the editor bigger. Maybe GH calculates the best size, but we're going fixed. */
.github-rte-type-wiki .github-rte-ckeditor > .ck-editor__editable {
	max-height: initial !important;

	/* Grow forever... pared with sticky toolbar. */
	height: initial;
	min-height: 360px;
	/*height: 390px;*/
}

/* Although the blur effect is nice, we're removing it here so the editor stays aligned with other fields. */
.github-rte-type-wiki .ck-editor__editable.ck-blurred {
	background-color: white !important;
}
